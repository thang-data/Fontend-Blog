{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/nguye/Desktop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"C:/Users/nguye/Desktop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"C:/Users/nguye/Desktop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{AUTH}from'../types/authType';import{ALERT}from'../types/alertType';import{checkImage,imageUpload}from'../../utils/ImageUpload';import{patchAPI,getAPI}from'../../utils/FetchData';import{checkPassword}from'../../utils/Valid';import{GET_OTHER_INFO}from'../types/profileType';import{checkTokenExp}from'../../utils/checkTokenExp';export var updateUser=function updateUser(avatar,name,auth){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var result,access_token,url,check,photo,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!auth.access_token||!auth.user)){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.next=4;return checkTokenExp(auth.access_token,dispatch);case 4:result=_context.sent;access_token=result?result:auth.access_token;url='';_context.prev=7;dispatch({type:ALERT,payload:{loading:true}});if(!avatar){_context.next=17;break;}check=checkImage(avatar);if(!check){_context.next=13;break;}return _context.abrupt(\"return\",dispatch({type:ALERT,payload:{errors:check}}));case 13:_context.next=15;return imageUpload(avatar);case 15:photo=_context.sent;url=photo.url;case 17:dispatch({type:AUTH,payload:{access_token:auth.access_token,user:_objectSpread(_objectSpread({},auth.user),{},{avatar:url?url:auth.user.avatar,name:name?name:auth.user.name})}});_context.next=20;return patchAPI('user',{avatar:url?url:auth.user.avatar,name:name?name:auth.user.name},access_token);case 20:res=_context.sent;dispatch({type:ALERT,payload:{success:res.data.msg}});_context.next=27;break;case 24:_context.prev=24;_context.t0=_context[\"catch\"](7);dispatch({type:ALERT,payload:{errors:_context.t0.response.data.msg}});case 27:case\"end\":return _context.stop();}}},_callee,null,[[7,24]]);}));return function(_x){return _ref.apply(this,arguments);};}();};export var resetPassword=function resetPassword(password,cf_password,token){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var result,access_token,msg,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return checkTokenExp(token,dispatch);case 2:result=_context2.sent;access_token=result?result:token;msg=checkPassword(password,cf_password);if(!msg){_context2.next=7;break;}return _context2.abrupt(\"return\",dispatch({type:ALERT,payload:{errors:msg}}));case 7:_context2.prev=7;dispatch({type:ALERT,payload:{loading:true}});_context2.next=11;return patchAPI('reset_password',{password:password},access_token);case 11:res=_context2.sent;dispatch({type:ALERT,payload:{success:res.data.msg}});_context2.next=18;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](7);dispatch({type:ALERT,payload:{errors:_context2.t0.response.data.msg}});case 18:case\"end\":return _context2.stop();}}},_callee2,null,[[7,15]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var getOtherInfo=function getOtherInfo(id){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;dispatch({type:ALERT,payload:{loading:true}});_context3.next=4;return getAPI(\"user/\".concat(id));case 4:res=_context3.sent;dispatch({type:GET_OTHER_INFO,payload:res.data});dispatch({type:ALERT,payload:{}});_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](0);dispatch({type:ALERT,payload:{errors:_context3.t0.response.data.msg}});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[0,9]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();};","map":{"version":3,"sources":["C:/Users/nguye/Desktop/client/src/redux/actions/userAction.ts"],"names":["AUTH","ALERT","checkImage","imageUpload","patchAPI","getAPI","checkPassword","GET_OTHER_INFO","checkTokenExp","updateUser","avatar","name","auth","dispatch","access_token","user","result","url","type","payload","loading","check","errors","photo","res","success","data","msg","response","resetPassword","password","cf_password","token","getOtherInfo","id"],"mappings":"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","sourcesContent":["import { Dispatch } from 'redux'\nimport { IAuth, IAuthType, AUTH } from '../types/authType'\nimport { IAlertType, ALERT } from '../types/alertType'\n\nimport { checkImage, imageUpload } from '../../utils/ImageUpload'\nimport { patchAPI, getAPI } from '../../utils/FetchData'\nimport { checkPassword } from '../../utils/Valid'\n\nimport { \n  GET_OTHER_INFO,\n  IGetOtherInfoType\n} from '../types/profileType'\n\nimport { checkTokenExp } from '../../utils/checkTokenExp'\n\n\nexport const updateUser = (\n  avatar: File, name: string, auth: IAuth\n) => async (dispatch: Dispatch<IAlertType | IAuthType>) => {\n  if(!auth.access_token || !auth.user) return;\n\n  const result = await checkTokenExp(auth.access_token, dispatch)\n  const access_token = result ? result : auth.access_token\n\n  let url = '';\n  try {\n    dispatch({ type: ALERT, payload: {loading: true}})\n    if(avatar){\n      const check = checkImage(avatar)\n      if(check) \n        return dispatch({ type: ALERT,payload: { errors: check } })\n\n      const photo = await imageUpload(avatar)\n      url = photo.url\n    }\n\n    dispatch({ \n      type: AUTH,\n      payload: {\n        access_token: auth.access_token,\n        user: {\n          ...auth.user,\n          avatar: url ? url : auth.user.avatar, \n          name: name ? name : auth.user.name\n        }\n      } \n    })\n\n    const res = await patchAPI('user', { \n      avatar: url ? url : auth.user.avatar, \n      name: name ? name : auth.user.name\n    }, access_token)\n\n    dispatch({ type: ALERT, payload: {success: res.data.msg}})\n\n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: {errors: err.response.data.msg}})\n  }\n}\n\n\nexport const resetPassword = (\n  password: string, cf_password: string, token: string\n) => async (dispatch: Dispatch<IAlertType | IAuthType>) => {\n  const result = await checkTokenExp(token, dispatch)\n  const access_token = result ? result : token\n\n  const msg = checkPassword(password, cf_password)\n  if(msg) return dispatch({ type: ALERT, payload: {errors: msg}})\n\n  try {\n    dispatch({ type: ALERT, payload: {loading: true}})\n\n    const res = await patchAPI('reset_password', { password }, access_token)\n\n    dispatch({ type: ALERT, payload: {success: res.data.msg}})\n\n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: {errors: err.response.data.msg}})\n  }\n}\n\n\nexport const getOtherInfo = (id: string) => \nasync (dispatch: Dispatch<IAlertType | IGetOtherInfoType>) => {\n  try {\n    dispatch({ type: ALERT, payload: {loading: true}})\n\n    const res = await getAPI(`user/${id}`)\n\n    dispatch({\n      type: GET_OTHER_INFO,\n      payload: res.data\n    })\n\n    dispatch({ type: ALERT, payload: { }})\n\n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: {errors: err.response.data.msg}})\n  }\n}"]},"metadata":{},"sourceType":"module"}