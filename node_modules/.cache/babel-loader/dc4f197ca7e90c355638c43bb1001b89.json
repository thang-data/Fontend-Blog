{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/nguye/Desktop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/nguye/Desktop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"C:/Users/nguye/Desktop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:/Users/nguye/Desktop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useCallback}from'react';import{useDispatch,useSelector}from'react-redux';import{Link,useHistory}from'react-router-dom';import Input from'../comments/Input';import Comments from'../comments/Comments';import Loading from'../global/Loading';import Pagination from'../global/Pagination';import{createComment,getComments}from'../../redux/actions/commentAction';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var DisplayBlog=function DisplayBlog(_ref){var blog=_ref.blog;var _useSelector=useSelector(function(state){return state;}),auth=_useSelector.auth,comments=_useSelector.comments;var dispatch=useDispatch();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),showComments=_useState2[0],setShowComments=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var history=useHistory();var handleComment=function handleComment(body){if(!auth.user||!auth.access_token)return;var data={content:body,user:auth.user,blog_id:blog._id,blog_user_id:blog.user._id,replyCM:[],createdAt:new Date().toISOString()};setShowComments([data].concat(_toConsumableArray(showComments)));dispatch(createComment(data,auth.access_token));};useEffect(function(){setShowComments(comments.data);},[comments.data]);var fetchComments=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){var num,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:num=_args.length>1&&_args[1]!==undefined?_args[1]:1;setLoading(true);_context.next=4;return dispatch(getComments(id,num));case 4:setLoading(false);case 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}(),[dispatch]);useEffect(function(){if(!blog._id)return;var num=history.location.search.slice(6)||1;fetchComments(blog._id,num);},[blog._id,fetchComments,history]);var handlePagination=function handlePagination(num){if(!blog._id)return;fetchComments(blog._id,num);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-center my-3 text-capitalize fs-1\",style:{color:'#ff7a00'},children:blog.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-end fst-italic\",style:{color:'teal'},children:[/*#__PURE__*/_jsx(\"small\",{children:typeof blog.user!=='string'&&\"By: \".concat(blog.user.name)}),/*#__PURE__*/_jsx(\"small\",{className:\"ms-2\",children:new Date(blog.createdAt).toLocaleString()})]}),/*#__PURE__*/_jsx(\"div\",{dangerouslySetInnerHTML:{__html:blog.content}}),/*#__PURE__*/_jsx(\"hr\",{className:\"my-1\"}),/*#__PURE__*/_jsx(\"h3\",{style:{color:'#ff7a00'},children:\"\\u2729 Comments \\u2729\"}),auth.user?/*#__PURE__*/_jsx(Input,{callback:handleComment}):/*#__PURE__*/_jsxs(\"h5\",{children:[\"Please \",/*#__PURE__*/_jsx(Link,{to:\"/login?blog/\".concat(blog._id),children:\"login\"}),\" to comment.\"]}),loading?/*#__PURE__*/_jsx(Loading,{}):showComments===null||showComments===void 0?void 0:showComments.map(function(comment,index){return/*#__PURE__*/_jsx(Comments,{comment:comment},index);}),comments.total>1&&/*#__PURE__*/_jsx(Pagination,{total:comments.total,callback:handlePagination})]});};export default DisplayBlog;","map":{"version":3,"sources":["C:/Users/nguye/Desktop/client/src/components/blog/DisplayBlog.tsx"],"names":["React","useState","useEffect","useCallback","useDispatch","useSelector","Link","useHistory","Input","Comments","Loading","Pagination","createComment","getComments","DisplayBlog","blog","state","auth","comments","dispatch","showComments","setShowComments","loading","setLoading","history","handleComment","body","user","access_token","data","content","blog_id","_id","blog_user_id","replyCM","createdAt","Date","toISOString","fetchComments","id","num","location","search","slice","handlePagination","color","title","name","toLocaleString","__html","map","comment","index","total"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { Link, useHistory } from 'react-router-dom'\n\nimport { IBlog, RootStore, IUser, IComment } from '../../utils/TypeScript'\n\nimport Input from '../comments/Input'\nimport Comments from '../comments/Comments'\nimport Loading from '../global/Loading'\nimport Pagination from '../global/Pagination'\n\nimport { \n  createComment, \n  getComments \n} from '../../redux/actions/commentAction'\n\n\ninterface IProps {\n  blog: IBlog\n}\n\nconst DisplayBlog: React.FC<IProps> = ({blog}) => {\n  const { auth, comments } = useSelector((state: RootStore) => state)\n  const dispatch = useDispatch()\n\n  const [showComments, setShowComments] = useState<IComment[]>([])\n  const [loading, setLoading] = useState(false)\n\n  const history = useHistory()\n\n\n  const handleComment = (body: string) => {\n    if(!auth.user || !auth.access_token) return;\n\n    const data = {\n      content: body,\n      user: auth.user,\n      blog_id: (blog._id as string),\n      blog_user_id: (blog.user as IUser)._id,\n      replyCM: [],\n      createdAt: new Date().toISOString()\n    }\n\n    setShowComments([data, ...showComments])\n    dispatch(createComment(data, auth.access_token))\n  }\n\n\n  useEffect(() => {\n    setShowComments(comments.data)\n  },[comments.data])\n\n\n  const fetchComments = useCallback(async(id: string, num = 1) => {\n    setLoading(true)\n    await dispatch(getComments(id, num))\n    setLoading(false)\n  },[dispatch])\n\n\n  useEffect(() => {\n    if(!blog._id) return;\n    const num = history.location.search.slice(6) || 1;\n    fetchComments(blog._id, num)\n  },[blog._id, fetchComments, history])\n\n  const handlePagination = (num: number) => {\n    if(!blog._id) return;\n    fetchComments(blog._id, num)\n  }\n\n\n  return (\n    <div>\n      <h2 className=\"text-center my-3 text-capitalize fs-1\"\n      style={{ color: '#ff7a00' }}>\n        {blog.title}\n      </h2>\n\n      <div className=\"text-end fst-italic\" style={{color: 'teal'}}>\n        <small>\n          {\n            typeof(blog.user) !== 'string' &&\n            `By: ${blog.user.name}`\n          }\n        </small>\n\n        <small className=\"ms-2\">\n          { new Date(blog.createdAt).toLocaleString() }\n        </small>\n      </div>\n\n      <div dangerouslySetInnerHTML={{\n        __html: blog.content\n      }} />\n\n      <hr className=\"my-1\" />\n      <h3 style={{color: '#ff7a00'}}>✩ Comments ✩</h3>\n\n      {\n        auth.user\n        ? <Input callback={handleComment} />\n        : <h5>\n          Please <Link to={`/login?blog/${blog._id}`}>login</Link> to comment.\n        </h5>\n      }\n      \n      {\n        loading\n        ? <Loading />\n        : showComments?.map((comment, index) => (\n          <Comments key={index} comment={comment} />\n        ))\n      }\n\n      {\n        comments.total > 1 &&\n        <Pagination \n        total={comments.total}\n        callback={handlePagination}\n        />\n      }\n    </div>\n  )\n}\n\nexport default DisplayBlog\n"]},"metadata":{},"sourceType":"module"}