{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/nguye/Desktop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/nguye/Desktop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{AUTH}from'../types/authType';import{ALERT}from'../types/alertType';import{postAPI,getAPI}from'../../utils/FetchData';import{validRegister,validPhone}from'../../utils/Valid';import{checkTokenExp}from'../../utils/checkTokenExp';export var login=function login(userLogin){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;dispatch({type:ALERT,payload:{loading:true}});_context.next=4;return postAPI('login',userLogin);case 4:res=_context.sent;dispatch({type:AUTH,payload:res.data});dispatch({type:ALERT,payload:{success:res.data.msg}});localStorage.setItem('logged','devat-channel');_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);dispatch({type:ALERT,payload:{errors:_context.t0.response.data.msg}});case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function(_x){return _ref.apply(this,arguments);};}();};export var register=function register(userRegister){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var check,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:check=validRegister(userRegister);if(!(check.errLength>0)){_context2.next=3;break;}return _context2.abrupt(\"return\",dispatch({type:ALERT,payload:{errors:check.errMsg}}));case 3:_context2.prev=3;dispatch({type:ALERT,payload:{loading:true}});_context2.next=7;return postAPI('register',userRegister);case 7:res=_context2.sent;dispatch({type:ALERT,payload:{success:res.data.msg}});_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](3);dispatch({type:ALERT,payload:{errors:_context2.t0.response.data.msg}});case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[3,11]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var refreshToken=function refreshToken(){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var logged,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:logged=localStorage.getItem('logged');if(!(logged!=='devat-channel')){_context3.next=3;break;}return _context3.abrupt(\"return\");case 3:_context3.prev=3;dispatch({type:ALERT,payload:{loading:true}});_context3.next=7;return getAPI('refresh_token');case 7:res=_context3.sent;dispatch({type:AUTH,payload:res.data});dispatch({type:ALERT,payload:{}});_context3.next=16;break;case 12:_context3.prev=12;_context3.t0=_context3[\"catch\"](3);dispatch({type:ALERT,payload:{errors:_context3.t0.response.data.msg}});localStorage.removeItem('logged');case 16:case\"end\":return _context3.stop();}}},_callee3,null,[[3,12]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export var logout=function logout(token){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var result,access_token;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return checkTokenExp(token,dispatch);case 2:result=_context4.sent;access_token=result?result:token;_context4.prev=4;localStorage.removeItem('logged');dispatch({type:AUTH,payload:{}});_context4.next=9;return getAPI('logout',access_token);case 9:_context4.next=14;break;case 11:_context4.prev=11;_context4.t0=_context4[\"catch\"](4);dispatch({type:ALERT,payload:{errors:_context4.t0.response.data.msg}});case 14:case\"end\":return _context4.stop();}}},_callee4,null,[[4,11]]);}));return function(_x4){return _ref4.apply(this,arguments);};}();};export var googleLogin=function googleLogin(id_token){return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(dispatch){var res;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;dispatch({type:ALERT,payload:{loading:true}});_context5.next=4;return postAPI('google_login',{id_token:id_token});case 4:res=_context5.sent;dispatch({type:AUTH,payload:res.data});dispatch({type:ALERT,payload:{success:res.data.msg}});localStorage.setItem('logged','devat-channel');_context5.next=13;break;case 10:_context5.prev=10;_context5.t0=_context5[\"catch\"](0);dispatch({type:ALERT,payload:{errors:_context5.t0.response.data.msg}});case 13:case\"end\":return _context5.stop();}}},_callee5,null,[[0,10]]);}));return function(_x5){return _ref5.apply(this,arguments);};}();};export var facebookLogin=function facebookLogin(accessToken,userID){return/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(dispatch){var res;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;dispatch({type:ALERT,payload:{loading:true}});_context6.next=4;return postAPI('facebook_login',{accessToken:accessToken,userID:userID});case 4:res=_context6.sent;dispatch({type:AUTH,payload:res.data});dispatch({type:ALERT,payload:{success:res.data.msg}});localStorage.setItem('logged','devat-channel');_context6.next=13;break;case 10:_context6.prev=10;_context6.t0=_context6[\"catch\"](0);dispatch({type:ALERT,payload:{errors:_context6.t0.response.data.msg}});case 13:case\"end\":return _context6.stop();}}},_callee6,null,[[0,10]]);}));return function(_x6){return _ref6.apply(this,arguments);};}();};export var loginSMS=function loginSMS(phone){return/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(dispatch){var check,res;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:check=validPhone(phone);if(check){_context7.next=3;break;}return _context7.abrupt(\"return\",dispatch({type:ALERT,payload:{errors:'Phone number format is incorrect.'}}));case 3:_context7.prev=3;dispatch({type:ALERT,payload:{loading:true}});_context7.next=7;return postAPI('login_sms',{phone:phone});case 7:res=_context7.sent;if(!res.data.valid)verifySMS(phone,dispatch);_context7.next=14;break;case 11:_context7.prev=11;_context7.t0=_context7[\"catch\"](3);dispatch({type:ALERT,payload:{errors:_context7.t0.response.data.msg}});case 14:case\"end\":return _context7.stop();}}},_callee7,null,[[3,11]]);}));return function(_x7){return _ref7.apply(this,arguments);};}();};export var verifySMS=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(phone,dispatch){var code,res;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:code=prompt('Enter your code');if(code){_context8.next=3;break;}return _context8.abrupt(\"return\");case 3:_context8.prev=3;dispatch({type:ALERT,payload:{loading:true}});_context8.next=7;return postAPI('sms_verify',{phone:phone,code:code});case 7:res=_context8.sent;dispatch({type:AUTH,payload:res.data});dispatch({type:ALERT,payload:{success:res.data.msg}});localStorage.setItem('logged','devat-channel');_context8.next=17;break;case 13:_context8.prev=13;_context8.t0=_context8[\"catch\"](3);dispatch({type:ALERT,payload:{errors:_context8.t0.response.data.msg}});setTimeout(function(){verifySMS(phone,dispatch);},100);case 17:case\"end\":return _context8.stop();}}},_callee8,null,[[3,13]]);}));return function verifySMS(_x8,_x9){return _ref8.apply(this,arguments);};}();export var forgotPassword=function forgotPassword(account){return/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(dispatch){var res;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.prev=0;dispatch({type:ALERT,payload:{loading:true}});_context9.next=4;return postAPI('forgot_password',{account:account});case 4:res=_context9.sent;dispatch({type:ALERT,payload:{success:res.data.msg}});_context9.next=11;break;case 8:_context9.prev=8;_context9.t0=_context9[\"catch\"](0);dispatch({type:ALERT,payload:{errors:_context9.t0.response.data.msg}});case 11:case\"end\":return _context9.stop();}}},_callee9,null,[[0,8]]);}));return function(_x10){return _ref9.apply(this,arguments);};}();};","map":{"version":3,"sources":["C:/Users/nguye/Desktop/client/src/redux/actions/authAction.ts"],"names":["AUTH","ALERT","postAPI","getAPI","validRegister","validPhone","checkTokenExp","login","userLogin","dispatch","type","payload","loading","res","data","success","msg","localStorage","setItem","errors","response","register","userRegister","check","errLength","errMsg","refreshToken","logged","getItem","removeItem","logout","token","result","access_token","googleLogin","id_token","facebookLogin","accessToken","userID","loginSMS","phone","valid","verifySMS","code","prompt","setTimeout","forgotPassword","account"],"mappings":"qSACA,OAASA,IAAT,KAAgC,mBAAhC,CACA,OAASC,KAAT,KAAkC,oBAAlC,CAGA,OAASC,OAAT,CAAkBC,MAAlB,KAAgC,uBAAhC,CACA,OAASC,aAAT,CAAwBC,UAAxB,KAA0C,mBAA1C,CACA,OAASC,aAAT,KAA8B,2BAA9B,CAGA,MAAO,IAAMC,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,CAACC,SAAD,iGACrB,iBAAOC,QAAP,0IAEIA,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEC,OAAO,CAAE,IAAX,CAAxB,CAAD,CAAR,CAFJ,sBAIsBV,CAAAA,OAAO,CAAC,OAAD,CAAUM,SAAV,CAJ7B,QAIUK,GAJV,eAMIJ,QAAQ,CAAC,CAAEC,IAAI,CAAEV,IAAR,CAAaW,OAAO,CAAEE,GAAG,CAACC,IAA1B,CAAD,CAAR,CAEAL,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEI,OAAO,CAAEF,GAAG,CAACC,IAAJ,CAASE,GAApB,CAAxB,CAAD,CAAR,CACAC,YAAY,CAACC,OAAb,CAAqB,QAArB,CAA+B,eAA/B,EATJ,iFAYIT,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEQ,MAAM,CAAE,YAAIC,QAAJ,CAAaN,IAAb,CAAkBE,GAA5B,CAAxB,CAAD,CAAR,CAZJ,qEADqB,gEAAd,CAkBP,MAAO,IAAMK,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACC,YAAD,kGACxB,kBAAOb,QAAP,oIACQc,KADR,CACgBnB,aAAa,CAACkB,YAAD,CAD7B,MAGKC,KAAK,CAACC,SAAN,CAAkB,CAHvB,4DAIWf,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEQ,MAAM,CAAEI,KAAK,CAACE,MAAhB,CAAxB,CAAD,CAJnB,0BAOIhB,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEC,OAAO,CAAE,IAAX,CAAxB,CAAD,CAAR,CAPJ,uBASsBV,CAAAA,OAAO,CAAC,UAAD,CAAaoB,YAAb,CAT7B,QASUT,GATV,gBAWIJ,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEI,OAAO,CAAEF,GAAG,CAACC,IAAJ,CAASE,GAApB,CAAxB,CAAD,CAAR,CAXJ,qFAaIP,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEQ,MAAM,CAAE,aAAIC,QAAJ,CAAaN,IAAb,CAAkBE,GAA5B,CAAxB,CAAD,CAAR,CAbJ,uEADwB,kEAAjB,CAmBP,MAAO,IAAMU,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,mGAC5B,kBAAOjB,QAAP,qIACQkB,MADR,CACiBV,YAAY,CAACW,OAAb,CAAqB,QAArB,CADjB,MAEKD,MAAM,GAAK,eAFhB,qFAKIlB,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEC,OAAO,CAAE,IAAX,CAAxB,CAAD,CAAR,CALJ,uBAOsBT,CAAAA,MAAM,CAAC,eAAD,CAP5B,QAOUU,GAPV,gBASIJ,QAAQ,CAAC,CAAEC,IAAI,CAAEV,IAAR,CAAaW,OAAO,CAAEE,GAAG,CAACC,IAA1B,CAAD,CAAR,CAEAL,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,EAAxB,CAAD,CAAR,CAXJ,qFAaIF,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEQ,MAAM,CAAE,aAAIC,QAAJ,CAAaN,IAAb,CAAkBE,GAA5B,CAAxB,CAAD,CAAR,CACAC,YAAY,CAACY,UAAb,CAAwB,QAAxB,EAdJ,uEAD4B,kEAArB,CAoBP,MAAO,IAAMC,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,CAACC,KAAD,kGACtB,kBAAOtB,QAAP,qKACuBH,CAAAA,aAAa,CAACyB,KAAD,CAAQtB,QAAR,CADpC,QACQuB,MADR,gBAEQC,YAFR,CAEuBD,MAAM,CAAGA,MAAH,CAAYD,KAFzC,kBAKId,YAAY,CAACY,UAAb,CAAwB,QAAxB,EACApB,QAAQ,CAAC,CAAEC,IAAI,CAAEV,IAAR,CAAcW,OAAO,CAAE,EAAvB,CAAD,CAAR,CANJ,uBAOUR,CAAAA,MAAM,CAAC,QAAD,CAAW8B,YAAX,CAPhB,6FASIxB,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEQ,MAAM,CAAE,aAAIC,QAAJ,CAAaN,IAAb,CAAkBE,GAA5B,CAAxB,CAAD,CAAR,CATJ,uEADsB,kEAAf,CAcP,MAAO,IAAMkB,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,QAAD,kGAC3B,kBAAO1B,QAAP,+IAEIA,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEC,OAAO,CAAE,IAAX,CAAxB,CAAD,CAAR,CAFJ,uBAIsBV,CAAAA,OAAO,CAAC,cAAD,CAAiB,CAAEiC,QAAQ,CAARA,QAAF,CAAjB,CAJ7B,QAIUtB,GAJV,gBAMIJ,QAAQ,CAAC,CAAEC,IAAI,CAAEV,IAAR,CAAaW,OAAO,CAAEE,GAAG,CAACC,IAA1B,CAAD,CAAR,CAEAL,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEI,OAAO,CAAEF,GAAG,CAACC,IAAJ,CAASE,GAApB,CAAxB,CAAD,CAAR,CACAC,YAAY,CAACC,OAAb,CAAqB,QAArB,CAA+B,eAA/B,EATJ,qFAYIT,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEQ,MAAM,CAAE,aAAIC,QAAJ,CAAaN,IAAb,CAAkBE,GAA5B,CAAxB,CAAD,CAAR,CAZJ,uEAD2B,kEAApB,CAiBP,MAAO,IAAMoB,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,WAAD,CAAsBC,MAAtB,kGAC7B,kBAAO7B,QAAP,+IAEIA,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEC,OAAO,CAAE,IAAX,CAAxB,CAAD,CAAR,CAFJ,uBAIsBV,CAAAA,OAAO,CAAC,gBAAD,CAAmB,CAAEmC,WAAW,CAAXA,WAAF,CAAeC,MAAM,CAANA,MAAf,CAAnB,CAJ7B,QAIUzB,GAJV,gBAMIJ,QAAQ,CAAC,CAAEC,IAAI,CAAEV,IAAR,CAAaW,OAAO,CAAEE,GAAG,CAACC,IAA1B,CAAD,CAAR,CAEAL,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEI,OAAO,CAAEF,GAAG,CAACC,IAAJ,CAASE,GAApB,CAAxB,CAAD,CAAR,CACAC,YAAY,CAACC,OAAb,CAAqB,QAArB,CAA+B,eAA/B,EATJ,qFAYIT,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEQ,MAAM,CAAE,aAAIC,QAAJ,CAAaN,IAAb,CAAkBE,GAA5B,CAAxB,CAAD,CAAR,CAZJ,uEAD6B,kEAAtB,CAkBP,MAAO,IAAMuB,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACC,KAAD,kGACxB,kBAAO/B,QAAP,oIACQc,KADR,CACgBlB,UAAU,CAACmC,KAAD,CAD1B,IAEMjB,KAFN,2DAGWd,QAAQ,CAAC,CACdC,IAAI,CAAET,KADQ,CAEdU,OAAO,CAAE,CAAEQ,MAAM,CAAE,mCAAV,CAFK,CAAD,CAHnB,0BASIV,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEC,OAAO,CAAE,IAAX,CAAxB,CAAD,CAAR,CATJ,uBAWsBV,CAAAA,OAAO,CAAC,WAAD,CAAc,CAAEsC,KAAK,CAALA,KAAF,CAAd,CAX7B,QAWU3B,GAXV,gBAaI,GAAG,CAACA,GAAG,CAACC,IAAJ,CAAS2B,KAAb,CACEC,SAAS,CAACF,KAAD,CAAQ/B,QAAR,CAAT,CAdN,qFAiBIA,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEQ,MAAM,CAAE,aAAIC,QAAJ,CAAaN,IAAb,CAAkBE,GAA5B,CAAxB,CAAD,CAAR,CAjBJ,uEADwB,kEAAjB,CAsBP,MAAO,IAAM0B,CAAAA,SAAS,2FAAG,kBACvBF,KADuB,CACR/B,QADQ,mIAGfkC,IAHe,CAGRC,MAAM,CAAC,iBAAD,CAHE,IAIjBD,IAJiB,oFAOnBlC,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEC,OAAO,CAAE,IAAX,CAAxB,CAAD,CAAR,CAPmB,uBASDV,CAAAA,OAAO,CAAC,YAAD,CAAe,CAAEsC,KAAK,CAALA,KAAF,CAASG,IAAI,CAAJA,IAAT,CAAf,CATN,QASb9B,GATa,gBAWnBJ,QAAQ,CAAC,CAAEC,IAAI,CAAEV,IAAR,CAAaW,OAAO,CAAEE,GAAG,CAACC,IAA1B,CAAD,CAAR,CAEAL,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEI,OAAO,CAAEF,GAAG,CAACC,IAAJ,CAASE,GAApB,CAAxB,CAAD,CAAR,CACAC,YAAY,CAACC,OAAb,CAAqB,QAArB,CAA+B,eAA/B,EAdmB,qFAgBnBT,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEQ,MAAM,CAAE,aAAIC,QAAJ,CAAaN,IAAb,CAAkBE,GAA5B,CAAxB,CAAD,CAAR,CACA6B,UAAU,CAAC,UAAM,CACfH,SAAS,CAACF,KAAD,CAAQ/B,QAAR,CAAT,CACD,CAFS,CAEP,GAFO,CAAV,CAjBmB,uEAAH,kBAATiC,CAAAA,SAAS,kDAAf,CAyBP,MAAO,IAAMI,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACC,OAAD,kGAC9B,kBAAOtC,QAAP,+IAEIA,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEC,OAAO,CAAE,IAAX,CAAxB,CAAD,CAAR,CAFJ,uBAIsBV,CAAAA,OAAO,CAAC,iBAAD,CAAoB,CAAE6C,OAAO,CAAPA,OAAF,CAApB,CAJ7B,QAIUlC,GAJV,gBAMIJ,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEI,OAAO,CAAEF,GAAG,CAACC,IAAJ,CAASE,GAApB,CAAxB,CAAD,CAAR,CANJ,mFAQIP,QAAQ,CAAC,CAAEC,IAAI,CAAET,KAAR,CAAeU,OAAO,CAAE,CAAEQ,MAAM,CAAE,aAAIC,QAAJ,CAAaN,IAAb,CAAkBE,GAA5B,CAAxB,CAAD,CAAR,CARJ,sEAD8B,mEAAvB","sourcesContent":["import { Dispatch } from 'redux'\nimport { AUTH, IAuthType } from '../types/authType'\nimport { ALERT, IAlertType } from '../types/alertType'\n\nimport { IUserLogin, IUserRegister } from '../../utils/TypeScript'\nimport { postAPI, getAPI } from '../../utils/FetchData'\nimport { validRegister, validPhone } from '../../utils/Valid'\nimport { checkTokenExp } from '../../utils/checkTokenExp'\n\n\nexport const login = (userLogin: IUserLogin) => \nasync (dispatch: Dispatch<IAuthType | IAlertType>) => {\n  try {\n    dispatch({ type: ALERT, payload: { loading: true } })\n\n    const res = await postAPI('login', userLogin)\n    \n    dispatch({ type: AUTH,payload: res.data })\n\n    dispatch({ type: ALERT, payload: { success: res.data.msg } })\n    localStorage.setItem('logged', 'devat-channel')\n    \n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: { errors: err.response.data.msg } })\n  }\n}\n\n\nexport const register = (userRegister: IUserRegister) => \nasync (dispatch: Dispatch<IAuthType | IAlertType>) => {\n  const check = validRegister(userRegister)\n  \n  if(check.errLength > 0)\n    return dispatch({ type: ALERT, payload: { errors: check.errMsg } })\n\n  try {\n    dispatch({ type: ALERT, payload: { loading: true } })\n    \n    const res = await postAPI('register', userRegister)\n\n    dispatch({ type: ALERT, payload: { success: res.data.msg } })\n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: { errors: err.response.data.msg } })\n  }\n}\n\n\nexport const refreshToken = () => \nasync (dispatch: Dispatch<IAuthType | IAlertType>) => {\n  const logged = localStorage.getItem('logged')\n  if(logged !== 'devat-channel') return;\n\n  try {\n    dispatch({ type: ALERT, payload: { loading: true } })\n    \n    const res = await getAPI('refresh_token')\n    \n    dispatch({ type: AUTH,payload: res.data })\n\n    dispatch({ type: ALERT, payload: { } })\n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: { errors: err.response.data.msg } })\n    localStorage.removeItem('logged')\n  }\n}\n\n\nexport const logout = (token: string) => \nasync (dispatch: Dispatch<IAuthType | IAlertType>) => {\n  const result = await checkTokenExp(token, dispatch)\n  const access_token = result ? result : token\n  \n  try {\n    localStorage.removeItem('logged')\n    dispatch({ type: AUTH, payload: { } })\n    await getAPI('logout', access_token)\n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: { errors: err.response.data.msg } })\n  }\n}\n\nexport const googleLogin = (id_token: string) => \nasync (dispatch: Dispatch<IAuthType | IAlertType>) => {\n  try {\n    dispatch({ type: ALERT, payload: { loading: true } })\n\n    const res = await postAPI('google_login', { id_token })\n    \n    dispatch({ type: AUTH,payload: res.data })\n\n    dispatch({ type: ALERT, payload: { success: res.data.msg } })\n    localStorage.setItem('logged', 'devat-channel')\n    \n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: { errors: err.response.data.msg } })\n  }\n}\n\nexport const facebookLogin = (accessToken: string, userID: string) => \nasync (dispatch: Dispatch<IAuthType | IAlertType>) => {\n  try {\n    dispatch({ type: ALERT, payload: { loading: true } })\n\n    const res = await postAPI('facebook_login', { accessToken, userID })\n    \n    dispatch({ type: AUTH,payload: res.data })\n\n    dispatch({ type: ALERT, payload: { success: res.data.msg } })\n    localStorage.setItem('logged', 'devat-channel')\n    \n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: { errors: err.response.data.msg } })\n  }\n}\n\n\nexport const loginSMS = (phone: string) => \nasync (dispatch: Dispatch<IAuthType | IAlertType>) => {\n  const check = validPhone(phone)\n  if(!check) \n    return dispatch({ \n      type: ALERT, \n      payload: { errors: 'Phone number format is incorrect.' }\n    });\n\n  try {\n    dispatch({ type: ALERT, payload: { loading: true } })\n\n    const res = await postAPI('login_sms', { phone })\n    \n    if(!res.data.valid)\n      verifySMS(phone, dispatch)\n    \n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: { errors: err.response.data.msg } })\n  }\n}\n\nexport const verifySMS = async (\n  phone: string, dispatch: Dispatch<IAuthType | IAlertType>\n) => {\n    const code = prompt('Enter your code')\n    if(!code) return;\n\n    try {\n      dispatch({ type: ALERT, payload: { loading: true } })\n\n      const res = await postAPI('sms_verify', { phone, code })\n      \n      dispatch({ type: AUTH,payload: res.data })\n\n      dispatch({ type: ALERT, payload: { success: res.data.msg } })\n      localStorage.setItem('logged', 'devat-channel')\n    } catch (err: any) {\n      dispatch({ type: ALERT, payload: { errors: err.response.data.msg } })\n      setTimeout(() => {\n        verifySMS(phone, dispatch)\n      }, 100);\n    }\n    \n}\n\n\nexport const forgotPassword = (account: string) => \nasync (dispatch: Dispatch<IAuthType | IAlertType>) => {\n  try {\n    dispatch({ type: ALERT, payload: { loading: true } })\n\n    const res = await postAPI('forgot_password', { account })\n\n    dispatch({ type: ALERT, payload: { success: res.data.msg } })\n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: { errors: err.response.data.msg } })\n  }\n}"]},"metadata":{},"sourceType":"module"}