{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/nguye/Desktop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"C:/Users/nguye/Desktop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"C:/Users/nguye/Desktop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/nguye/Desktop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useRef,useEffect}from'react';import{useSelector,useDispatch}from'react-redux';import{validCreateBlog,shallowEqual}from'../utils/Valid';import{getAPI}from'../utils/FetchData';import NotFound from'../components/global/NotFound';import CreateForm from'../components/cards/CreateForm';import CardHoriz from'../components/cards/CardHoriz';import ReactQuill from'../components/editor/ReactQuill';import{ALERT}from'../redux/types/alertType';import{createBlog,updateBlog}from'../redux/actions/blogAction';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CreateBlog=function CreateBlog(_ref){var id=_ref.id;var initState={user:'',title:'',content:'',description:'',thumbnail:'',category:'',createdAt:new Date().toISOString()};var _useState=useState(initState),_useState2=_slicedToArray(_useState,2),blog=_useState2[0],setBlog=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),body=_useState4[0],setBody=_useState4[1];var divRef=useRef(null);var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),text=_useState6[0],setText=_useState6[1];var _useSelector=useSelector(function(state){return state;}),auth=_useSelector.auth;var dispatch=useDispatch();var _useState7=useState(initState),_useState8=_slicedToArray(_useState7,2),oldData=_useState8[0],setOldData=_useState8[1];useEffect(function(){if(!id)return;getAPI(\"blog/\".concat(id)).then(function(res){setBlog(res.data);setBody(res.data.content);setOldData(res.data);}).catch(function(err){return console.log(err);});var initData={user:'',title:'',content:'',description:'',thumbnail:'',category:'',createdAt:new Date().toISOString()};return function(){setBlog(initData);setBody('');setOldData(initData);};},[id]);useEffect(function(){var div=divRef.current;if(!div)return;var text=div===null||div===void 0?void 0:div.innerText;setText(text);},[body]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var check,newData,_auth$user,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(auth.access_token){_context.next=2;break;}return _context.abrupt(\"return\");case 2:check=validCreateBlog(_objectSpread(_objectSpread({},blog),{},{content:text}));if(!(check.errLength!==0)){_context.next=5;break;}return _context.abrupt(\"return\",dispatch({type:ALERT,payload:{errors:check.errMsg}}));case 5:newData=_objectSpread(_objectSpread({},blog),{},{content:body});if(!id){_context.next=15;break;}if(!(blog.user._id!==((_auth$user=auth.user)===null||_auth$user===void 0?void 0:_auth$user._id))){_context.next=9;break;}return _context.abrupt(\"return\",dispatch({type:ALERT,payload:{errors:'Invalid Authentication.'}}));case 9:result=shallowEqual(oldData,newData);if(!result){_context.next=12;break;}return _context.abrupt(\"return\",dispatch({type:ALERT,payload:{errors:'The data does not change.'}}));case 12:dispatch(updateBlog(newData,auth.access_token));_context.next=16;break;case 15:dispatch(createBlog(newData,auth.access_token));case 16:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(){return _ref2.apply(this,arguments);};}();if(!auth.access_token)return/*#__PURE__*/_jsx(NotFound,{});return/*#__PURE__*/_jsxs(\"div\",{className:\"my-4 create_blog\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"row mt-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Create\"}),/*#__PURE__*/_jsx(CreateForm,{blog:blog,setBlog:setBlog})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Preview\"}),/*#__PURE__*/_jsx(CardHoriz,{blog:blog})]})]}),/*#__PURE__*/_jsx(ReactQuill,{setBody:setBody,body:body}),/*#__PURE__*/_jsx(\"div\",{ref:divRef,dangerouslySetInnerHTML:{__html:body},style:{display:'none'}}),/*#__PURE__*/_jsx(\"small\",{children:text.length}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-dark mt-3 d-block mx-auto\",onClick:handleSubmit,children:id?'Update Post':'Create Post'})]});};export default CreateBlog;","map":{"version":3,"sources":["C:/Users/nguye/Desktop/client/src/pages/create_blog.tsx"],"names":["React","useState","useRef","useEffect","useSelector","useDispatch","validCreateBlog","shallowEqual","getAPI","NotFound","CreateForm","CardHoriz","ReactQuill","ALERT","createBlog","updateBlog","CreateBlog","id","initState","user","title","content","description","thumbnail","category","createdAt","Date","toISOString","blog","setBlog","body","setBody","divRef","text","setText","state","auth","dispatch","oldData","setOldData","then","res","data","catch","err","console","log","initData","div","current","innerText","handleSubmit","access_token","check","errLength","type","payload","errors","errMsg","newData","_id","result","__html","display","length"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from 'react'\nimport { useSelector, useDispatch } from 'react-redux'\n\nimport { RootStore, IBlog, IUser } from '../utils/TypeScript'\nimport { validCreateBlog, shallowEqual } from '../utils/Valid'\nimport { getAPI } from '../utils/FetchData'\n\nimport NotFound from '../components/global/NotFound'\nimport CreateForm from '../components/cards/CreateForm'\nimport CardHoriz from '../components/cards/CardHoriz'\n\nimport ReactQuill from '../components/editor/ReactQuill'\n\nimport { ALERT } from '../redux/types/alertType'\n\nimport { createBlog, updateBlog } from '../redux/actions/blogAction'\n\ninterface IProps {\n  id?: string\n}\nconst CreateBlog: React.FC<IProps> = ({id}) => {\n  const initState = {\n    user: '',\n    title: '',\n    content: '',\n    description: '',\n    thumbnail: '',\n    category: '',\n    createdAt: new Date().toISOString()\n  }\n\n  const [blog, setBlog] = useState<IBlog>(initState)\n  const [body, setBody] = useState('')\n\n  const divRef = useRef<HTMLDivElement>(null)\n  const [text, setText] = useState('')\n\n  const { auth } = useSelector((state: RootStore) => state)\n  const dispatch = useDispatch()\n\n  const [oldData, setOldData] = useState<IBlog>(initState)\n\n  useEffect(() => {\n    if(!id) return;\n\n    getAPI(`blog/${id}`)\n    .then(res => {\n      setBlog(res.data)\n      setBody(res.data.content)\n      setOldData(res.data)\n    })\n    .catch(err => console.log(err))\n\n    const initData = {\n      user: '',\n      title: '',\n      content: '',\n      description: '',\n      thumbnail: '',\n      category: '',\n      createdAt: new Date().toISOString()\n    }\n\n    return () => {\n      setBlog(initData)\n      setBody('')\n      setOldData(initData)\n    }\n  },[id])\n\n  useEffect(() => {\n    const div = divRef.current;\n    if(!div) return;\n\n    const text = (div?.innerText as string)\n    setText(text)\n  },[body])\n\n  const handleSubmit = async() => {\n    if(!auth.access_token) return;\n\n    const check = validCreateBlog({...blog, content: text})\n    if(check.errLength !== 0){\n      return dispatch({ type: ALERT, payload: { errors: check.errMsg } })\n    }\n\n    let newData = {...blog, content: body}\n\n    if(id){\n      if((blog.user as IUser)._id !== auth.user?._id)\n        return dispatch({\n          type: ALERT,\n          payload: { errors: 'Invalid Authentication.' }\n        })\n\n      const result = shallowEqual(oldData, newData)\n      if(result) return dispatch({\n        type: ALERT,\n        payload: { errors: 'The data does not change.' }\n      })\n\n      dispatch(updateBlog(newData, auth.access_token))\n    }else{\n      dispatch(createBlog(newData, auth.access_token))\n    }\n  }\n\n\n  if(!auth.access_token) return <NotFound />;\n  return (\n    <div className=\"my-4 create_blog\">\n\n      <div className=\"row mt-4\">\n        <div className=\"col-md-6\">\n          <h5>Create</h5>\n          <CreateForm blog={blog} setBlog={setBlog} />\n        </div>\n\n        <div className=\"col-md-6\">\n          <h5>Preview</h5>\n          <CardHoriz  blog={blog} />\n        </div>\n      </div>  \n\n      <ReactQuill setBody={setBody} body={body} />\n\n      <div ref={divRef} dangerouslySetInnerHTML={{\n        __html: body\n      }} style={{display: 'none'}} />\n\n      <small>{text.length}</small>\n      \n      <button className=\"btn btn-dark mt-3 d-block mx-auto\"\n      onClick={handleSubmit}>\n        { id ? 'Update Post' : 'Create Post' }\n      </button>\n    </div>\n  )\n}\n\nexport default CreateBlog\n"]},"metadata":{},"sourceType":"module"}